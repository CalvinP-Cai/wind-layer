(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{627:function(t,i,n){"use strict";n.r(i),n.d(i,"Field",(function(){return d})),n.d(i,"WindLayer",(function(){return w}));n(69),n(70),n(127),n(27),n(124),n(6),n(128),n(129),n(130),n(131),n(132),n(133),n(68),n(2),n(125),n(28);var e=n(22);
/*!
 * author: sakitam-fdd <smilefdd@gmail.com> 
 * amap-wind v1.0.0-alpha.0
 * build-time: 2020-3-2 21:25
 * LICENSE: MIT
 * (c) 2017-2020 https://github.com/sakitam-fdd/wind-layer#readme
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function o(){for(var t=0,i=0,n=arguments.length;i<n;i++)t+=arguments[i].length;var e=Array(t),o=0;for(i=0;i<n;i++)for(var s=arguments[i],r=0,a=s.length;r<a;r++,o++)e[o]=s[r];return e}
/*!
 * author: sakitam-fdd <smilefdd@gmail.com> 
 * wind-core v1.0.0-alpha.0
 * build-time: 2020-3-2 21:8
 * LICENSE: MIT
 * (c) 2017-2020 https://github.com/sakitam-fdd/wind-layer#readme
 */var s=function(){function t(t,i){this.u=t,this.v=i}return t.prototype.magnitude=function(){return Math.sqrt(this.u*this.u+this.v*this.v)},t.prototype.directionTo=function(){var t=Math.atan2(this.u,this.v)*(180/Math.PI);return t<0&&(t+=360),t},t.prototype.directionFrom=function(){return(this.directionTo()+180)%360},t}();
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function r(){for(var t=0,i=0,n=arguments.length;i<n;i++)t+=arguments[i].length;var e=Array(t),o=0;for(i=0;i<n;i++)for(var s=arguments[i],r=0,a=s.length;r<a;r++,o++)e[o]=s[r];return e}Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,i){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),e=1;e<arguments.length;e++){var o=arguments[e];if(null!=o)for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])}return n},writable:!0,configurable:!0});var a=Object.prototype.hasOwnProperty,h="undefined"!=typeof Symbol?Symbol.toStringTag:void 0;function p(t){if(!function(t){var i=Object(e.a)(t);return null!==t&&("object"===i||"function"===i)}(t))return!1;var i=function(t){if(null===t)return void 0===t?"[object Undefined]":"[object Null]";if(!(h&&h in Object(t)))return toString.call(t);var i=a.call(t,h),n=t[h],e=!1;try{t[h]=void 0,e=!0}catch(t){}var o=Object.prototype.toString.call(t);return e&&(i?t[h]=n:delete t[h]),o}(t);return"[object Function]"===i||"[object AsyncFunction]"===i||"[object GeneratorFunction]"===i||"[object Proxy]"===i}function c(t){return"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)}function l(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];return Object.assign.apply(Object,r([t],i))}function u(t){console.warn("wind-layer: "+t)}var d=function(){function t(t){this.grid=[],this.xmin=t.xmin,this.xmax=t.xmax,this.ymin=Math.min(t.ymax,t.ymin),this.ymax=Math.max(t.ymax,t.ymin),this.cols=t.cols,this.rows=t.rows,this.us=t.us,this.vs=t.vs,this.deltaX=t.deltaX,this.deltaY=t.deltaY;var i=Math.ceil((this.xmax-this.xmin)/t.deltaX),n=Math.ceil((this.ymax-this.ymin)/t.deltaY);i===this.cols&&n===this.rows||console.warn("The data grid is not available"),this.isContinuous=Math.floor(this.cols*t.deltaX)>=360,this.wrappedX="wrappedX"in t?t.wrappedX:this.xmax>180,this.grid=this.buildGrid(),this.range=this.calculateRange()}return t.prototype.buildGrid=function(){for(var t=[],i=0,n=this.rows,e=this.cols,o=this.us,r=this.vs,a=0;a<n;a++){for(var h=[],p=0;p<e;p++,i++){var c=o[i],l=r[i],u=this.isValid(c)&&this.isValid(l);h[p]=u?new s(c,l):null}this.isContinuous&&h.push(h[0]),t[a]=h}return t},t.prototype.release=function(){this.grid=[]},t.prototype.extent=function(){return[this.xmin,this.ymin,this.xmax,this.ymax]},t.prototype.bilinearInterpolateVector=function(t,i,n,e,o,r){var a=1-t,h=1-i,p=a*h,c=t*h,l=a*i,u=t*i,d=n.u*p+e.u*c+o.u*l+r.u*u,f=n.v*p+e.v*c+o.v*l+r.v*u;return new s(d,f)},t.prototype.calculateRange=function(){if(this.grid&&this.grid[0]){for(var t,i,n=this.grid.length,e=this.grid[0].length,o=0;o<n;o++)for(var s=0;s<e;s++){var r=this.grid[o][s];if(null!==r){var a=r.magnitude();void 0===t?t=a:void 0===i?(i=a,t=Math.min(t,i),i=Math.max(t,i)):(t=Math.min(a,t),i=Math.max(a,i))}}return[t,i]}},t.prototype.isValid=function(t){return null!=t},t.prototype.getWrappedLongitudes=function(){var t=this.xmin,i=this.xmax;return this.wrappedX&&(this.isContinuous?(t=-180,i=180):(i=this.xmax-360,t=this.xmin-360)),[t,i]},t.prototype.contains=function(t,i){var n=this.getWrappedLongitudes(),e=n[0],o=n[1],s=t>=e&&t<=o,r=i>=this.ymin&&i<=this.ymax;return s&&r},t.prototype.getDecimalIndexes=function(t,i){var n,e;return[((n=t-this.xmin)-(e=360)*Math.floor(n/e))/this.deltaX,(this.ymax-i)/this.deltaY]},t.prototype.valueAt=function(t,i){if(!this.contains(t,i))return null;var n=this.getDecimalIndexes(t,i),e=Math.floor(n[0]),o=Math.floor(n[1]),s=this.clampColumnIndex(e),r=this.clampRowIndex(o);return this.valueAtIndexes(s,r)},t.prototype.interpolatedValueAt=function(t,i){if(!this.contains(t,i))return null;var n=this.getDecimalIndexes(t,i),e=n[0],o=n[1];return this.interpolatePoint(e,o)},t.prototype.hasValueAt=function(t,i){return null!==this.valueAt(t,i)&&!0},t.prototype.interpolatePoint=function(t,i){var n=this.getFourSurroundingIndexes(t,i),e=n[0],o=n[1],s=n[2],r=n[3],a=this.getFourSurroundingValues(e,o,s,r);if(a){var h=a[0],p=a[1],c=a[2],l=a[3];return this.bilinearInterpolateVector(t-e,i-s,h,p,c,l)}return null},t.prototype.clampColumnIndex=function(t){var i=t;t<0&&(i=0);var n=this.cols-1;return t>n&&(i=n),i},t.prototype.clampRowIndex=function(t){var i=t;t<0&&(i=0);var n=this.rows-1;return t>n&&(i=n),i},t.prototype.getFourSurroundingIndexes=function(t,i){var n=Math.floor(t),e=n+1;this.isContinuous&&e>=this.cols&&(e=0),e=this.clampColumnIndex(e);var o=this.clampRowIndex(Math.floor(i));return[n,e,o,this.clampRowIndex(o+1)]},t.prototype.getFourSurroundingValues=function(t,i,n,e){var o;if(o=this.grid[n]){var s=o[t],r=o[i];if(this.isValid(s)&&this.isValid(r)&&(o=this.grid[e])){var a=o[t],h=o[i];if(this.isValid(a)&&this.isValid(h))return[s,r,a,h]}}return null},t.prototype.valueAtIndexes=function(t,i){return this.grid[i][t]},t.prototype.lonLatAtIndexes=function(t,i){return[this.longitudeAtX(t),this.latitudeAtY(i)]},t.prototype.longitudeAtX=function(t){var i=this.deltaX/2,n=this.xmin+i+t*this.deltaX;return this.wrappedX&&(n=n>180?n-360:n),n},t.prototype.latitudeAtY=function(t){var i=this.deltaY/2;return this.ymax-i-t*this.deltaY},t.prototype.randomize=function(t){void 0===t&&(t={});var i=Math.random()*this.cols|0,n=Math.random()*this.rows|0;return t.x=this.longitudeAtX(i),t.y=this.latitudeAtY(n),t},t}(),f={globalAlpha:.9,lineWidth:1,colorScale:"#fff",velocityScale:.04,maxAge:90,paths:800,frameRate:20,minVelocity:0,maxVelocity:10,generateParticleOption:!0};var v=function(){function t(t,i,n){if(this.generated=!1,this.ctx=t,!this.ctx)throw new Error("ctx error");this.setOptions(i),this.animate=this.animate.bind(this),n&&this.updateData(n)}return t.prototype.setOptions=function(t){this.options=Object.assign({},f,t);var i=this.ctx.canvas,n=i.width,e=i.height;"particleAge"in t&&!("maxAge"in t)&&c(this.options.particleAge)&&(this.options.maxAge=this.options.particleAge),"particleMultiplier"in t&&!("paths"in t)&&c(this.options.particleMultiplier)&&(this.options.paths=Math.round(n*e*this.options.particleMultiplier))},t.prototype.getOptions=function(){return this.options},t.prototype.updateData=function(t){this.field=t},t.prototype.moveParticles=function(){for(var t=this.particles,i=this.options.maxAge,n=p(this.options.velocityScale)?this.options.velocityScale():this.options.velocityScale,e=0,o=t.length;e<o;e++){var s=t[e];s.age>i&&(this.field.randomize(s),s.age=0);var r=s.x,a=s.y,h=this.field.interpolatedValueAt(r,a);if(null===h)s.age=i;else{var c=r+h.u*n,l=a+h.v*n;this.field.hasValueAt(c,l)?(s.xt=c,s.yt=l,s.m=h.magnitude()):s.age=i}s.age+=1}},t.prototype.drawParticles=function(){var t,i=this.particles,n=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation="destination-in",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.globalCompositeOperation=n,this.ctx.fillStyle="rgba(0, 0, 0, "+this.options.globalAlpha+")",this.ctx.lineWidth=c(this.options.lineWidth)?this.options.lineWidth:1,this.ctx.strokeStyle=null!=(t=this.options.colorScale)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)?this.options.colorScale:"#fff";var e=0,o=i.length;if(this.field&&o>0)for(var s=this.field.range,r=s[0],a=s[1];e<o;e++)this.drawParticle(i[e],r,a)},t.prototype.drawParticle=function(t,i,n){var e=[t.x,t.y],o=[t.xt||e[0],t.yt||e[1]];if(this.intersectsCoordinate(o)&&t.age<=this.options.maxAge){var s=this.project(e),r=this.project(o);if(s&&r){if(this.ctx.beginPath(),this.ctx.moveTo(s[0],s[1]),this.ctx.lineTo(r[0],r[1]),t.x=t.xt,t.y=t.yt,p(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){var a=function(t,i,n,e){return Math.max(0,Math.min(e.length-1,Math.round((t-i)/(n-i)*(e.length-1))))}(t.m,i,n,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[a]}p(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),this.ctx.stroke()}}},t.prototype.prepareParticlePaths=function(){var t="function"==typeof this.options.paths?this.options.paths(this):this.options.paths,i=[];if(!this.field)return[];for(var n=0;n<t;n++){var e=this.field.randomize();e.age=this.randomize(),i.push(e)}return i},t.prototype.randomize=function(){return Math.floor(Math.random()*this.options.maxAge)},t.prototype.project=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];throw new Error("must be overriden")},t.prototype.intersectsCoordinate=function(t){throw new Error("must be overriden")},t.prototype.start=function(){this.starting=!0,this.forceStop=!1,this._then=Date.now(),this.animate()},t.prototype.stop=function(){cancelAnimationFrame(this.animationLoop),this.starting=!1,this.forceStop=!0},t.prototype.animate=function(){this.animationLoop&&cancelAnimationFrame(this.animationLoop),this.animationLoop=requestAnimationFrame(this.animate);var t=Date.now(),i=t-this._then;i>this.options.frameRate&&(this._then=t-i%this.options.frameRate,this.render())},t.prototype.prerender=function(){var t=p(this.options.generateParticleOption)?this.options.generateParticleOption():this.options.generateParticleOption;t||this.generated?t&&(this.particles=this.prepareParticlePaths(),this.generated=!0):(this.particles=this.prepareParticlePaths(),this.generated=!0),this.starting||this.forceStop||(this.starting=!0,this._then=Date.now(),this.animate())},t.prototype.render=function(){this.moveParticles(),this.drawParticles(),this.postrender()},t.prototype.postrender=function(){},t.Field=d,t}(),m="undefined"==typeof window?global:window,y=null==m?void 0:m.AMap;if(!y)throw new Error("Before using this plugin, you must first introduce the amap JS API <https://lbs.amap.com/api/javascript-api/summary>");var g={context:"2d",animation:!1,opacity:1,zIndex:12,zooms:[0,22],windOptions:{}},x=function(){function t(t,i){void 0===i&&(i={}),this.options=l({},g,i),this.canvas=null,this.layer_=null,this.wind=null,this.init=this.init.bind(this),this.handleResize=this.handleResize.bind(this),this.canvasFunction=this.canvasFunction.bind(this),this._addReFreshHandle=this._addReFreshHandle.bind(this),this.pickWindOptions(),t&&this.setData(t)}return t.prototype.appendTo=function(t){if(!t)throw new Error("not map object");this.init(t)},t.prototype.init=function(t){if(!t)throw new Error("not map object");this.map=t,this.context=this.options.context||"2d",this.getCanvasLayer(),this.map.on("resize",this.handleResize,this)},t.prototype.handleResize=function(){this.canvas&&this.canvasFunction()},t.prototype.render=function(t){if(!this.getData())return this;var i=this.getWindOptions();if(t&&!this.wind){var n=this.getData(),e=this.getContext();e&&(this.wind=new v(e,i,n),this.wind.project=this.project.bind(this),this.wind.intersectsCoordinate=this.intersectsCoordinate.bind(this),this.wind.postrender=function(){},this.wind.prerender())}if(this.wind){if("generateParticleOption"in i)("function"==typeof i.generateParticleOption?i.generateParticleOption():i.generateParticleOption)&&this.wind.prerender();this.wind.render()}return this._addReFreshHandle(),this},t.prototype._addReFreshHandle=function(){this.map&&("3d"===this.map.getViewMode_().toLowerCase()&&(this.layer_&&this.layer_.reFresh(),y.Util.requestAnimFrame(this._addReFreshHandle)))},t.prototype.getCanvasLayer=function(){if(!this.canvas&&!this.layer_){var t=this.canvasFunction(),i=this._getBounds(),n={canvas:t,bounds:this.options.bounds||i};this.options.zooms&&(n.zooms=this.options.zooms),"zIndex"in this.options&&"number"==typeof this.options.zIndex&&(n.zIndex=this.options.zIndex),"opacity"in this.options&&"number"==typeof this.options.opacity&&(n.opacity=this.options.opacity),this.layer_=new y.CanvasLayer(n),this.map.on("mapmove",this.canvasFunction,this),this.map.on("zoomchange",this.canvasFunction,this),this.layer_.setMap(this.map)}},t.prototype.canvasFunction=function(){var t=y.Browser.retina,i=[this.map.getSize().width,this.map.getSize().height],n=i[0],e=i[1];if(this.canvas){this.canvas.width=n*t,this.canvas.height=e*t;var o=this._getBounds();this.layer_&&this.layer_.setBounds(this.options.bounds||o)}else this.canvas=function(t,i,n,e){if("undefined"!=typeof document){var o=document.createElement("canvas");return o.width=t*n,o.height=i*n,o}return new e(t*n,i*n)}(n,e,t,null);return this.canvas&&this.render(this.canvas),this.canvas},t.prototype._getBounds=function(){var t,i,n=this.map.getViewMode_(),e=[void 0,void 0],s=e[0],r=e[1],a=this.map.getBounds();if("2d"===n.toLowerCase())r=a.getNorthEast(),s=a.getSouthWest();else{var h=a.bounds.map((function(t){return[t.getLng(),t.getLat()]}));s=new((t=y.LngLat).bind.apply(t,o([void 0],h[3]))),r=new((i=y.LngLat).bind.apply(i,o([void 0],h[1])))}return new y.Bounds(s,r)},t.prototype.removeLayer=function(){this.map&&(this.layer_.setMap(null),this.map.off("resize",this.handleResize,this),this.map.off("mapmove",this.canvasFunction,this),this.map.off("zoomchange",this.canvasFunction,this),delete this.map,delete this.layer_,delete this.canvas)},t.prototype.project=function(t){var i,n=this.map.lngLatToContainer(new((i=y.LngLat).bind.apply(i,o([void 0],t))));return[n.x,n.y]},t.prototype.intersectsCoordinate=function(t){var i;return this._getBounds().contains(new((i=y.LngLat).bind.apply(i,o([void 0],t))))},t.prototype.getContext=function(){if(null!==this.canvas)return this.canvas.getContext(this.context)},t.prototype.pickWindOptions=function(){var t=this;Object.keys(f).forEach((function(i){i in t.options&&(void 0===t.options.windOptions&&(t.options.windOptions={}),t.options.windOptions[i]=t.options[i])}))},t.prototype.getData=function(){return this.field},t.prototype.setData=function(t){var i;return t&&t instanceof d?this.field=t:(i=t,Array.isArray(i)?this.field=function(t){var i,n;if(t.forEach((function(t){switch(t.header.parameterCategory+","+t.header.parameterNumber){case"1,2":case"2,2":i=t;break;case"1,3":case"2,3":n=t}})),n&&i){var e=i.header;return new d({xmin:e.lo1,ymin:e.la2,xmax:360,ymax:e.la1,deltaX:1,deltaY:1,cols:360,rows:181,us:i.data,vs:n.data,wrappedX:!1})}}(t):console.error("Illegal data")),this.map&&this.canvas&&this.field&&this.render(this.canvas),this},t.prototype.updateParams=function(t){return void 0===t&&(t={}),u("will move to setWindOptions"),this.setWindOptions(t),this},t.prototype.getParams=function(){return u("will move to getWindOptions"),this.getWindOptions()},t.prototype.setWindOptions=function(t){var i=this.options.windOptions||{};this.options=l(this.options,{windOptions:l(i,t||{})}),this.wind&&this.wind.setOptions(this.options.windOptions)},t.prototype.getWindOptions=function(){return this.options.windOptions||{}},t}(),w=x;i.default=x}}]);