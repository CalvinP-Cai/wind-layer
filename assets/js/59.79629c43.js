(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{667:function(t,i,n){"use strict";n.r(i),n.d(i,"Field",(function(){return d})),n.d(i,"WindLayer",(function(){return P}));n(79),n(80),n(147),n(36),n(144),n(12),n(148),n(149),n(150),n(151),n(39),n(152),n(153),n(154),n(100),n(155),n(78),n(156),n(5),n(145),n(157),n(158),n(159),n(160),n(161),n(162),n(163),n(164),n(165),n(166),n(167),n(168),n(169),n(170),n(171),n(172),n(173),n(174),n(175),n(176),n(177),n(178),n(179),n(180),n(37);var e=n(30),o=function(t,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])})(t,i)};function r(){for(var t=arguments,i=0,n=0,e=arguments.length;n<e;n++)i+=t[n].length;var o=Array(i),r=0;for(n=0;n<e;n++)for(var s=arguments[n],a=0,h=s.length;a<h;a++,r++)o[r]=s[a];return o}Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,i){var n=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),o=1;o<arguments.length;o++){var r=n[o];if(null!=r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},writable:!0,configurable:!0});var s=Object.prototype.hasOwnProperty,a="undefined"!=typeof Symbol?Symbol.toStringTag:void 0;function h(t){if(!function(t){var i=Object(e.a)(t);return null!==t&&("object"===i||"function"===i)}(t))return!1;var i=function(t){if(null===t)return void 0===t?"[object Undefined]":"[object Null]";if(!(a&&a in Object(t)))return toString.call(t);var i=s.call(t,a),n=t[a],e=!1;try{t[a]=void 0,e=!0}catch(t){}var o=Object.prototype.toString.call(t);return e&&(i?t[a]=n:delete t[a]),o}(t);return"[object Function]"===i||"[object AsyncFunction]"===i||"[object GeneratorFunction]"===i||"[object Proxy]"===i}function c(t){return"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)}function u(t){for(var i=arguments,n=[],e=1;e<arguments.length;e++)n[e-1]=i[e];return Object.assign.apply(Object,r([t],n))}function p(t){console.warn("wind-layer: "+t)}function l(t){return null!=t&&!isNaN(t)}var f=function(){function t(t,i){this.u=t,this.v=i,this.m=this.magnitude()}return t.prototype.magnitude=function(){return Math.sqrt(this.u*this.u+this.v*this.v)},t.prototype.directionTo=function(){var t=Math.atan2(this.u,this.v)*(180/Math.PI);return t<0&&(t+=360),t},t.prototype.directionFrom=function(){return(this.directionTo()+180)%360},t}(),d=function(){function t(t){this.grid=[],this.xmin=t.xmin,this.xmax=t.xmax,this.ymin=Math.min(t.ymax,t.ymin),this.ymax=Math.max(t.ymax,t.ymin),this.cols=t.cols,this.rows=t.rows,this.us=t.us,this.vs=t.vs,this.deltaX=t.deltaX,this.deltaY=t.deltaY,this.isFields=!0;var i=Math.ceil((this.xmax-this.xmin)/t.deltaX),n=Math.ceil((this.ymax-this.ymin)/t.deltaY);i===this.cols&&n===this.rows||console.warn("The data grid not equal"),this.isContinuous=Math.floor(this.cols*t.deltaX)>=360,this.wrappedX="wrappedX"in t?t.wrappedX:this.xmax>180,this.grid=this.buildGrid(),this.range=this.calculateRange()}return t.prototype.buildGrid=function(){for(var t=[],i=0,n=this.rows,e=this.cols,o=this.us,r=this.vs,s=0;s<n;s++){for(var a=[],h=0;h<e;h++,i++){var c=o[i],u=r[i],p=this.isValid(c)&&this.isValid(u);a[h]=p?new f(c,u):null}this.isContinuous&&a.push(a[0]),t[s]=a}return t},t.prototype.release=function(){this.grid=[],this.columns=[]},t.prototype.extent=function(){return[this.xmin,this.ymin,this.xmax,this.ymax]},t.prototype.bilinearInterpolateVector=function(t,i,n,e,o,r){var s=1-t,a=1-i,h=s*a,c=t*a,u=s*i,p=t*i,l=n.u*h+e.u*c+o.u*u+r.u*p,d=n.v*h+e.v*c+o.v*u+r.v*p;return new f(l,d)},t.prototype.calculateRange=function(){if(this.grid&&this.grid[0]){for(var t,i,n=this.grid.length,e=this.grid[0].length,o=0;o<n;o++)for(var r=0;r<e;r++){var s=this.grid[o][r];if(null!==s){var a=s.m||s.magnitude();void 0===t?t=a:void 0===i?(i=a,t=Math.min(t,i),i=Math.max(t,i)):(t=Math.min(a,t),i=Math.max(a,i))}}return[t,i]}},t.prototype.isValid=function(t){return null!=t},t.prototype.getWrappedLongitudes=function(){var t=this.xmin,i=this.xmax;return this.wrappedX&&(this.isContinuous?(t=-180,i=180):(i=this.xmax-360,t=this.xmin-360)),[t,i]},t.prototype.contains=function(t,i){var n=this.getWrappedLongitudes(),e=n[0],o=n[1],r=t>=e&&t<=o,s=i>=this.ymin&&i<=this.ymax;return r&&s},t.prototype.getDecimalIndexes=function(t,i){var n,e;return[((n=t-this.xmin)-(e=360)*Math.floor(n/e))/this.deltaX,(this.ymax-i)/this.deltaY]},t.prototype.valueAt=function(t,i){if(!this.contains(t,i))return null;var n=this.getDecimalIndexes(t,i),e=Math.floor(n[0]),o=Math.floor(n[1]),r=this.clampColumnIndex(e),s=this.clampRowIndex(o);return this.valueAtIndexes(r,s)},t.prototype.interpolatedValueAt=function(t,i){if(!this.contains(t,i))return null;var n=this.getDecimalIndexes(t,i),e=n[0],o=n[1];return this.interpolatePoint(e,o)},t.prototype.hasValueAt=function(t,i){return null!==this.valueAt(t,i)},t.prototype.interpolatePoint=function(t,i){var n=this.getFourSurroundingIndexes(t,i),e=n[0],o=n[1],r=n[2],s=n[3],a=this.getFourSurroundingValues(e,o,r,s);if(a){var h=a[0],c=a[1],u=a[2],p=a[3];return this.bilinearInterpolateVector(t-e,i-r,h,c,u,p)}return null},t.prototype.clampColumnIndex=function(t){var i=t;t<0&&(i=0);var n=this.cols-1;return t>n&&(i=n),i},t.prototype.clampRowIndex=function(t){var i=t;t<0&&(i=0);var n=this.rows-1;return t>n&&(i=n),i},t.prototype.getFourSurroundingIndexes=function(t,i){var n=Math.floor(t),e=n+1;this.isContinuous&&e>=this.cols&&(e=0),e=this.clampColumnIndex(e);var o=this.clampRowIndex(Math.floor(i));return[n,e,o,this.clampRowIndex(o+1)]},t.prototype.getFourSurroundingValues=function(t,i,n,e){var o;if(o=this.grid[n]){var r=o[t],s=o[i];if(this.isValid(r)&&this.isValid(s)&&(o=this.grid[e])){var a=o[t],h=o[i];if(this.isValid(a)&&this.isValid(h))return[r,s,a,h]}}return null},t.prototype.valueAtIndexes=function(t,i){return this.grid[i][t]},t.prototype.lonLatAtIndexes=function(t,i){return[this.longitudeAtX(t),this.latitudeAtY(i)]},t.prototype.longitudeAtX=function(t){var i=this.deltaX/2,n=this.xmin+i+t*this.deltaX;return this.wrappedX&&(n=n>180?n-360:n),n},t.prototype.latitudeAtY=function(t){var i=this.deltaY/2;return this.ymax-i-t*this.deltaY},t.prototype.randomize=function(t,i,n,e){void 0===t&&(t={});var o=Math.random()*(i||this.cols)|0,r=Math.random()*(n||this.rows)|0,s=e([o,r]);return null!==s?(t.x=s[0],t.y=s[1]):(t.x=this.longitudeAtX(o),t.y=this.latitudeAtY(r)),t},t.prototype.checkFields=function(){return this.isFields},t.prototype.startBatchInterpolate=function(t,i,n){},t}();function v(t,i){if(!t)return!1;if(i=i||devicePixelRatio||1,!(t instanceof OffscreenCanvas)){var n=t.clientWidth*i,e=t.clientHeight*i;if(n<=0||e<=0)return!1;if(t.width!==n||t.height!==e)return t.width=n,t.height=e,!0}return!1}function m(t,i,n){var e=t.createShader(i);if(t.shaderSource(e,n),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))throw t.deleteShader(e),new Error(t.getShaderInfoLog(e)||"");return e}var g="undefined"!=typeof Float32Array?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=arguments,i=0,n=arguments.length;n--;)i+=t[n]*t[n];return Math.sqrt(i)});var y=function(){function t(t,i,n){var e;this.vertShader="",this.fragShader="",i&&(this.vertShader=i),n&&(this.fragShader=n),this.program=function(t,i,n){var e=m(t,t.VERTEX_SHADER,i),o=m(t,t.FRAGMENT_SHADER,n),r=t.createProgram();if(null!==r&&(t.attachShader(r,e),t.attachShader(r,o),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS)))throw new Error(t.getProgramInfoLog(r)||"");return r}(t,this.vertShader,this.fragShader),this.gl=t,this.textureUnit=0,this.uniformSetters=this.createUniformSetters(),this.attribSetters=this.createAttributeSetters(),this.transfromStack=[],this.projection=(e=new g(9),g!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e)}return t.prototype.active=function(){return this.gl.useProgram(this.program),this},t.prototype.deactive=function(){return this.gl.deleteProgram(this.program),this},t.prototype.getBindPointForSamplerType=function(t,i){return i===t.SAMPLER_2D?t.TEXTURE_2D:i===t.SAMPLER_CUBE?t.TEXTURE_CUBE_MAP:void 0},t.prototype.createUniformSetter=function(t,i){var n,e,o=this.gl,r=o.getUniformLocation(t,i.name),s=i.type,a=i.size>1&&"[0]"===i.name.substr(-3);if(s===o.FLOAT&&a)return function(t){o.uniform1fv(r,t)};if(s===o.FLOAT)return function(t){o.uniform1f(r,t)};if(s===o.FLOAT_VEC2)return function(t){o.uniform2fv(r,t)};if(s===o.FLOAT_VEC3)return function(t){o.uniform3fv(r,t)};if(s===o.FLOAT_VEC4)return function(t){o.uniform4fv(r,t)};if(s===o.INT&&a)return function(t){o.uniform1iv(r,t)};if(s===o.INT)return function(t){o.uniform1i(r,t)};if(s===o.INT_VEC2)return function(t){o.uniform2iv(r,t)};if(s===o.INT_VEC3)return function(t){o.uniform3iv(r,t)};if(s===o.INT_VEC4)return function(t){o.uniform4iv(r,t)};if(s===o.BOOL)return function(t){o.uniform1iv(r,t)};if(s===o.BOOL_VEC2)return function(t){o.uniform2iv(r,t)};if(s===o.BOOL_VEC3)return function(t){o.uniform3iv(r,t)};if(s===o.BOOL_VEC4)return function(t){o.uniform4iv(r,t)};if(s===o.FLOAT_MAT2)return function(t){o.uniformMatrix2fv(r,!1,t)};if(s===o.FLOAT_MAT3)return function(t){o.uniformMatrix3fv(r,!1,t)};if(s===o.FLOAT_MAT4)return function(t){o.uniformMatrix4fv(r,!1,t)};if((s===o.SAMPLER_2D||s===o.SAMPLER_CUBE)&&a){for(var h=[],c=0;c<i.size;++c)h.push(this.textureUnit++);return function(t,i){return function(n){o.uniform1iv(r,i),n.forEach((function(n,e){o.activeTexture(o.TEXTURE0+i[e]),void 0!==t&&o.bindTexture(t,n)}))}}(this.getBindPointForSamplerType(o,s),h)}if(s===o.SAMPLER_2D||s===o.SAMPLER_CUBE)return n=this.getBindPointForSamplerType(o,s),e=this.textureUnit++,function(t){o.uniform1i(r,e),o.activeTexture(o.TEXTURE0+e),void 0!==n&&o.bindTexture(n,t)};throw"unknown type: 0x"+s.toString(16)},t.prototype.createUniformSetters=function(){var t=this.gl;this.textureUnit=0;var i={};if(null!==this.program)for(var n=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),e=0;e<n;++e){var o=t.getActiveUniform(this.program,e);if(!o)break;var r=o.name;"[0]"===r.substr(-3)&&(r=r.substr(0,r.length-3));var s=this.createUniformSetter(this.program,o);i[r]=s}return i},t.prototype.createAttribSetter=function(t){var i=this.gl;return function(n){i.bindBuffer(i.ARRAY_BUFFER,n.buffer),i.enableVertexAttribArray(t),void 0===n.numComponents&&void 0===n.size||i.vertexAttribPointer(t,n.numComponents||n.size,n.type||i.FLOAT,n.normalize||!1,n.stride||0,n.offset||0)}},t.prototype.createAttributeSetters=function(){var t=this.gl,i={};if(null!==this.program)for(var n=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),e=0;e<n;++e){var o=t.getActiveAttrib(this.program,e);if(!o)break;var r=t.getAttribLocation(this.program,o.name);i[o.name]=this.createAttribSetter(r)}return i},t.prototype.setAttributes=function(t,i){return i=i?i.attribSetters||i:this.attribSetters,Object.keys(t).forEach((function(n){var e=i[n];e&&e(t[n])})),this},t.prototype.setUniforms=function(t,i){return i=i?i.uniformSetters||i:this.uniformSetters,Object.keys(t).forEach((function(n){var e=i[n];e&&e(t[n])})),this},t.prototype.clear=function(t){return function(t,i){var n=i[0],e=i[1],o=i[2],r=i[3];t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(n,e,o,r),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.enable(t.DEPTH_TEST)}(this.gl,t),this.transfromStack=[],this},t.prototype.runTimes=function(t){return this.count=t||0,this},t.prototype.updateProjection=function(){var t=this.gl.canvas,i=t.width,n=t.height;return function(t,i,n){t[0]=2/i,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1}(this.projection,i,n),this},t.prototype.resize=function(t){return v(this.gl.canvas),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),t&&this.updateProjection(),this},t.prototype.draw=function(){throw new Error("should override")},t.prototype.translate=function(){throw new Error("should override")},t.prototype.rotate=function(){throw new Error("should override")},t.prototype.scale=function(){throw new Error("should override")},t}(),x="precision mediump float;\n#define GLSLIFY 1\n\n// 从顶点着色器中传入\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor = v_color;\n}\n",w="#define GLSLIFY 1\nattribute vec2 a_position;\nattribute vec4 a_color;\n\n//uniform mat4 u_matrix;\nuniform vec2 u_resolution;\nvarying vec4 v_color;\nuniform float u_pointSize;\n\nvoid main() {\n  // convert the rectangle from pixels to 0.0 to 1.0\n  vec2 zeroToOne = a_position / u_resolution;\n\n  // convert from 0->1 to 0->2\n  vec2 zeroToTwo = zeroToOne * 2.0;\n\n  // convert from 0->2 to -1->+1 (clipspace)\n  vec2 clipSpace = zeroToTwo - 1.0;\n\n  // 未翻转Y轴\n  //  gl_Position = vec4(a_position, 0, 1);\n  // 翻转Y轴\n  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  // Multiply the position by the matrix.\n//  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\n  // 将颜色传递给片断着色器\n  v_color = a_color;\n\n  gl_PointSize = u_pointSize;\n}\n",S=(function(t){function i(i,n,e){var o=t.call(this,i,n||w,e||x)||this;return o.vertShader=w,o.fragShader=x,o}(function(t,i){function n(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)})(i,t),i.prototype.updateProjection=function(){return this},i.prototype.draw=function(){var t=this.gl.POINTS;return this.gl.drawArrays(t,0,this.count),this},i.prototype.translate=function(){return this},i.prototype.rotate=function(){return this},i.prototype.scale=function(){return this}}(y),{globalAlpha:.9,lineWidth:1,colorScale:"#fff",velocityScale:.04,maxAge:90,paths:800,frameRate:20,minVelocity:0,maxVelocity:10,useCoordsDraw:!0,gpet:!0});function b(t,i,n,e){return Math.max(0,Math.min(e.length-1,Math.round((t-i)/(n-i)*(e.length-1))))}var A,_=function(){function t(t,i,n){if(this.generated=!1,this.ctx=t,!this.ctx)throw new Error("ctx error");this.animate=this.animate.bind(this),this.setOptions(i),n&&this.updateData(n)}return t.prototype.setOptions=function(t){this.options=Object.assign({},S,t);var i=this.ctx.canvas,n=i.width,e=i.height;"particleAge"in t&&!("maxAge"in t)&&c(this.options.particleAge)&&(this.options.maxAge=this.options.particleAge),"particleMultiplier"in t&&!("paths"in t)&&c(this.options.particleMultiplier)&&(this.options.paths=Math.round(n*e*this.options.particleMultiplier)),this.prerender()},t.prototype.getOptions=function(){return this.options},t.prototype.updateData=function(t){this.field=t},t.prototype.moveParticles=function(){for(var t=this.ctx.canvas,i=t.width,n=t.height,e=this.particles,o=this.options.maxAge,r=h(this.options.velocityScale)?this.options.velocityScale():this.options.velocityScale,s=0,a=e.length;s<a;s++){var c=e[s];c.age>o&&(c.age=0,this.field.randomize(c,i,n,this.unproject));var u=c.x,p=c.y,l=this.field.interpolatedValueAt(u,p);if(null===l)c.age=o;else{var f=u+l.u*r,d=p+l.v*r;this.field.hasValueAt(f,d)?(c.xt=f,c.yt=d,c.m=l.m):(c.x=f,c.y=d,c.age=o)}c.age++}},t.prototype.fadeIn=function(){var t=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation="destination-in",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.globalCompositeOperation=t},t.prototype.drawParticles=function(){var t,i=this.particles;this.fadeIn(),this.ctx.globalAlpha=this.options.globalAlpha,this.ctx.fillStyle="rgba(0, 0, 0, "+this.options.globalAlpha+")",this.ctx.lineWidth=c(this.options.lineWidth)?this.options.lineWidth:1,this.ctx.strokeStyle=null!=(t=this.options.colorScale)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)?this.options.colorScale:"#fff";var n=0,e=i.length;if(this.field&&e>0)for(var o=this.field.range,r=o[0],s=o[1];n<e;n++)this[this.options.useCoordsDraw?"drawCoordsParticle":"drawPixelParticle"](i[n],r,s)},t.prototype.drawPixelParticle=function(t,i,n){var e=[t.x,t.y],o=[t.xt,t.yt];if(o&&e&&l(o[0])&&l(o[1])&&l(e[0])&&l(e[1])&&t.age<=this.options.maxAge){if(this.ctx.beginPath(),this.ctx.moveTo(e[0],e[1]),this.ctx.lineTo(o[0],o[1]),h(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){var r=b(t.m,i,n,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[r]}h(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),t.x=t.xt,t.y=t.yt,this.ctx.stroke()}},t.prototype.drawCoordsParticle=function(t,i,n){var e=[t.x,t.y],o=[t.xt,t.yt];if(o&&e&&l(o[0])&&l(o[1])&&l(e[0])&&l(e[1])&&this.intersectsCoordinate(o)&&t.age<=this.options.maxAge){var r=this.project(e),s=this.project(o);if(r&&s){if(this.ctx.beginPath(),this.ctx.moveTo(r[0],r[1]),this.ctx.lineTo(s[0],s[1]),t.x=t.xt,t.y=t.yt,h(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){var a=b(t.m,i,n,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[a]}h(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),this.ctx.stroke()}}},t.prototype.prepareParticlePaths=function(){var t=this.ctx.canvas,i=t.width,n=t.height,e="function"==typeof this.options.paths?this.options.paths(this):this.options.paths,o=[];if(!this.field)return[];"startBatchInterpolate"in this.field&&this.field.startBatchInterpolate(i,n,this.unproject);for(var r=0;r<e;r++)o.push(this.field.randomize({age:this.randomize()},i,n,this.unproject));return o},t.prototype.randomize=function(){return Math.floor(Math.random()*this.options.maxAge)},t.prototype.project=function(){for(var t=arguments,i=[],n=0;n<arguments.length;n++)i[n]=t[n];throw new Error("project must be overriden")},t.prototype.unproject=function(){for(var t=arguments,i=[],n=0;n<arguments.length;n++)i[n]=t[n];throw new Error("unproject must be overriden")},t.prototype.intersectsCoordinate=function(t){throw new Error("must be overriden")},t.prototype.clearCanvas=function(){this.stop(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.forceStop=!1},t.prototype.start=function(){this.starting=!0,this.forceStop=!1,this._then=Date.now(),this.animate()},t.prototype.stop=function(){cancelAnimationFrame(this.animationLoop),this.starting=!1,this.forceStop=!0},t.prototype.animate=function(){this.animationLoop&&cancelAnimationFrame(this.animationLoop),this.animationLoop=requestAnimationFrame(this.animate);var t=Date.now(),i=t-this._then;i>this.options.frameRate&&(this._then=t-i%this.options.frameRate,this.render())},t.prototype.prerender=function(){this.generated=!1,this.particles=this.prepareParticlePaths(),this.generated=!0,this.starting||this.forceStop||(this.starting=!0,this._then=Date.now(),this.animate())},t.prototype.render=function(){this.moveParticles(),this.drawParticles(),this.postrender()},t.prototype.postrender=function(){},t.Field=d,t}(),O=null===(A="undefined"==typeof window?global:window)||void 0===A?void 0:A.AMap;if(!O)throw new Error("Before using this plugin, you must first introduce the amap JS API <https://lbs.amap.com/api/javascript-api/summary>");var T={context:"2d",animation:!1,opacity:1,zIndex:12,zooms:[0,22],windOptions:{}},E=function(){function t(t,i){void 0===i&&(i={}),this.options=u({},T,i),this.canvas=null,this.layer_=null,this.wind=null,this.init=this.init.bind(this),this.handleResize=this.handleResize.bind(this),this.canvasFunction=this.canvasFunction.bind(this),this._addReFreshHandle=this._addReFreshHandle.bind(this),this.pickWindOptions(),t&&this.setData(t)}return t.prototype.appendTo=function(t){if(!t)throw new Error("not map object");this.init(t)},t.prototype.init=function(t){if(!t)throw new Error("not map object");this.map=t,this.context=this.options.context||"2d",this.getCanvasLayer(),this.map.on("resize",this.handleResize,this)},t.prototype.handleResize=function(){this.canvas&&this.canvasFunction()},t.prototype.render=function(t){if(!this.getData())return this;var i=this.getWindOptions();if(t&&!this.wind){var n=this.getData(),e=this.getContext();e&&(this.wind=new _(e,i,n),this.wind.project=this.project.bind(this),this.wind.unproject=this.unproject.bind(this),this.wind.intersectsCoordinate=this.intersectsCoordinate.bind(this),this.wind.postrender=function(){})}return this.wind&&(this.wind.prerender(),this.wind.render()),this._addReFreshHandle(),this},t.prototype._addReFreshHandle=function(){this.map&&("3d"===this.map.getViewMode_().toLowerCase()&&(this.layer_&&this.layer_.reFresh(),O.Util.requestAnimFrame(this._addReFreshHandle)))},t.prototype.getCanvasLayer=function(){if(!this.canvas&&!this.layer_){var t=this.canvasFunction(),i=this._getBounds(),n={canvas:t,bounds:this.options.bounds||i};this.options.zooms&&(n.zooms=this.options.zooms),"zIndex"in this.options&&"number"==typeof this.options.zIndex&&(n.zIndex=this.options.zIndex),"opacity"in this.options&&"number"==typeof this.options.opacity&&(n.opacity=this.options.opacity),this.layer_=new O.CanvasLayer(n),this.map.on("mapmove",this.canvasFunction,this),this.map.on("zoomchange",this.canvasFunction,this),this.layer_.setMap(this.map)}},t.prototype.canvasFunction=function(){var t=O.Browser.retina?2:1,i=[this.map.getSize().width,this.map.getSize().height],n=i[0],e=i[1];if(this.canvas){this.canvas.width=n*t,this.canvas.height=e*t;var o=this._getBounds();this.layer_&&this.layer_.setBounds(this.options.bounds||o)}else this.canvas=function(t,i,n,e){if("undefined"!=typeof document){var o=document.createElement("canvas");return o.width=t*n,o.height=i*n,o}return new e(t*n,i*n)}(n,e,t,null);return this.canvas&&this.render(this.canvas),this.canvas},t.prototype._getBounds=function(){var t=this.map.getViewMode_(),i=[void 0,void 0],n=i[0],e=i[1],o=this.map.getBounds();if("2d"===t.toLowerCase())e=o.getNorthEast(),n=o.getSouthWest();else{var r=o.bounds.map((function(t){return[t.getLng(),t.getLat()]}));n=new O.LngLat(r[3][0],r[3][1]),e=new O.LngLat(r[1][0],r[1][1])}return new O.Bounds(n,e)},t.prototype.removeLayer=function(){this.map&&(this.layer_.setMap(null),this.map.off("resize",this.handleResize,this),this.map.off("mapmove",this.canvasFunction,this),this.map.off("zoomchange",this.canvasFunction,this),delete this.map,delete this.layer_,delete this.canvas)},t.prototype.project=function(t){var i=O.Browser.retina?2:1,n=this.map.lngLatToContainer(new O.LngLat(t[0],t[1],!0));return[n.x*i,n.y*i]},t.prototype.unproject=function(t){var i=this.map.pixelToLngLat(new O.Pixel(t[0],t[1]));return[i.lng,i.lat]},t.prototype.intersectsCoordinate=function(t){return this._getBounds().contains(new O.LngLat(t[0],t[1]))},t.prototype.getContext=function(){if(null!==this.canvas)return this.canvas.getContext(this.context)},t.prototype.pickWindOptions=function(){var t=this;Object.keys(S).forEach((function(i){i in t.options&&(void 0===t.options.windOptions&&(t.options.windOptions={}),t.options.windOptions[i]=t.options[i])}))},t.prototype.getData=function(){return this.field},t.prototype.setData=function(t){var i;return t&&t.checkFields&&t.checkFields()?this.field=t:(i=t,Array.isArray(i)?this.field=function(t){var i,n;if(console.time("format-data"),t.forEach((function(t){switch(t.header.parameterCategory+","+t.header.parameterNumber){case"1,2":case"2,2":i=t;break;case"1,3":case"2,3":n=t}})),n&&i){var e=i.header,o=new d({xmin:e.lo1,ymin:e.la2,xmax:e.lo2,ymax:e.la1,deltaX:e.dx,deltaY:e.dy,cols:e.nx,rows:e.ny,us:i.data,vs:n.data});return console.timeEnd("format-data"),o}}(t):console.error("Illegal data")),this.map&&this.canvas&&this.field&&this.render(this.canvas),this},t.prototype.updateParams=function(t){return void 0===t&&(t={}),p("will move to setWindOptions"),this.setWindOptions(t),this},t.prototype.getParams=function(){return p("will move to getWindOptions"),this.getWindOptions()},t.prototype.setWindOptions=function(t){var i=this.options.windOptions||{};this.options=u(this.options,{windOptions:u(i,t||{})}),this.wind&&(this.wind.setOptions(this.options.windOptions),this.wind.prerender())},t.prototype.getWindOptions=function(){return this.options.windOptions||{}},t}(),P=E;i.default=E}}]);